---
sidebar_position: 5
---

import AESVisualizer from '@site/src/components/ciphers/AESVisualizer';

# AES (Advanced Encryption Standard)

Симметричный блочный шифр, принятый как стандарт шифрования США в 2001 году.

## Интерактивная визуализация

<AESVisualizer />

## Характеристики

| Параметр | AES-128 | AES-192 | AES-256 |
|----------|---------|---------|---------|
| Размер блока | 128 бит | 128 бит | 128 бит |
| Размер ключа | 128 бит | 192 бит | 256 бит |
| Раундов | 10 | 12 | 14 |

## Структура AES

AES использует **SP-сеть** (Substitution-Permutation Network), а не сеть Фейстеля.

### Состояние (State)

128-битный блок представляется как матрица 4×4 байт:

```
┌────┬────┬────┬────┐
│ s0 │ s4 │ s8 │ s12│
├────┼────┼────┼────┤
│ s1 │ s5 │ s9 │ s13│
├────┼────┼────┼────┤
│ s2 │ s6 │ s10│ s14│
├────┼────┼────┼────┤
│ s3 │ s7 │ s11│ s15│
└────┴────┴────┴────┘
```

Байты записываются **по столбцам**.

## Операции раунда

### 1. SubBytes

Нелинейная замена каждого байта через S-Box.

```
S-Box вычисляется как:
1. Мультипликативная инверсия в GF(2⁸)
2. Аффинное преобразование
```

**Свойства S-Box:**
- Биективный (один-к-одному)
- Нелинейность: 112 (из 128 максимум)
- Дифференциальная вероятность: 2⁻⁶
- Линейная вероятность: 2⁻³

### 2. ShiftRows

Циклический сдвиг строк влево:

```
Строка 0: без сдвига    [a b c d] → [a b c d]
Строка 1: сдвиг на 1    [e f g h] → [f g h e]
Строка 2: сдвиг на 2    [i j k l] → [k l i j]
Строка 3: сдвиг на 3    [m n o p] → [p m n o]
```

Обеспечивает **диффузию между столбцами**.

### 3. MixColumns

Умножение каждого столбца на фиксированную матрицу в GF(2⁸):

```
┌   ┐   ┌           ┐   ┌   ┐
│ s'0│   │ 02 03 01 01│   │ s0│
│ s'1│ = │ 01 02 03 01│ × │ s1│
│ s'2│   │ 01 01 02 03│   │ s2│
│ s'3│   │ 03 01 01 02│   │ s3│
└   ┘   └           ┘   └   ┘
```

Умножение в GF(2⁸) с неприводимым полиномом: x⁸ + x⁴ + x³ + x + 1

**Не выполняется в последнем раунде!**

### 4. AddRoundKey

XOR состояния с раундовым ключом:

```
state' = state ⊕ round_key
```

## Расписание ключей (Key Schedule)

### AES-128

Из 128-битного ключа генерируется 11 раундовых ключей (176 байт):

```python
# Псевдокод
def key_expansion(key):
    w = [key[0:4], key[4:8], key[8:12], key[12:16]]  # 4 слова
    
    for i in range(4, 44):
        temp = w[i-1]
        if i % 4 == 0:
            temp = SubWord(RotWord(temp)) ⊕ Rcon[i/4]
        w[i] = w[i-4] ⊕ temp
    
    return w
```

**Rcon** — константы раундов:
```
Rcon[1] = 01 00 00 00
Rcon[2] = 02 00 00 00
Rcon[3] = 04 00 00 00
...
```

## Режимы работы

| Режим | Описание | Параллелизм | IV |
|-------|----------|-------------|-----|
| **ECB** | Каждый блок независимо | ✅ | ❌ |
| **CBC** | Цепочка блоков | ❌ шифр / ✅ дешифр | ✅ |
| **CTR** | Счётчик | ✅ | ✅ (nonce) |
| **GCM** | CTR + аутентификация | ✅ | ✅ |
| **XTS** | Для дисков | ✅ | ✅ (tweak) |

### ECB (Electronic Codebook)

```
C₁ = E(K, P₁)
C₂ = E(K, P₂)
...
```

⚠️ **Не рекомендуется** — одинаковые блоки дают одинаковый шифротекст.

### CBC (Cipher Block Chaining)

```
C₁ = E(K, P₁ ⊕ IV)
C₂ = E(K, P₂ ⊕ C₁)
...
```

### CTR (Counter)

```
C₁ = P₁ ⊕ E(K, Nonce || Counter)
C₂ = P₂ ⊕ E(K, Nonce || Counter+1)
...
```

### GCM (Galois/Counter Mode)

CTR + GHASH для аутентификации. Выдаёт тег подлинности.

## Padding

Для блочных режимов (ECB, CBC) требуется дополнение до размера блока.

### PKCS#7

Дополнение байтами, равными количеству добавленных байт:

```
Данные: [01 02 03 04 05 06 07 08 09 0A 0B]
Padding: [01 02 03 04 05 06 07 08 09 0A 0B 05 05 05 05 05]
```

### Требования

- Всегда добавляется (даже если данные кратны 16)
- При снятии padding проверяется корректность

## Атаки

| Атака | Описание | Защита |
|-------|----------|--------|
| Brute Force | Перебор ключей | 128+ бит ключа |
| Side-channel | Timing, Power analysis | Constant-time реализация |
| Padding Oracle | Утечка через ошибки padding | AEAD режимы (GCM) |
| Related-key | Связанные ключи | Не используются в практике |

## Сравнение с другими шифрами

| Параметр | AES | DES | 3DES | ChaCha20 |
|----------|-----|-----|------|----------|
| Блок | 128 | 64 | 64 | Поточный |
| Ключ | 128/192/256 | 56 | 112/168 | 256 |
| Структура | SP-сеть | Фейстель | Фейстель | ARX |
| Статус | ✅ Актуален | ❌ Устарел | ⚠️ Legacy | ✅ Актуален |

## Реализация

### OpenSSL

```bash
# Шифрование
openssl enc -aes-256-cbc -in file.txt -out file.enc

# Дешифрование
openssl enc -d -aes-256-cbc -in file.enc -out file.txt
```

### Python

```python
from Crypto.Cipher import AES
from Crypto.Random import get_random_bytes

key = get_random_bytes(32)  # AES-256
cipher = AES.new(key, AES.MODE_GCM)
ciphertext, tag = cipher.encrypt_and_digest(plaintext)
```

### JavaScript (Web Crypto)

```javascript
const key = await crypto.subtle.generateKey(
  { name: "AES-GCM", length: 256 },
  true,
  ["encrypt", "decrypt"]
);

const encrypted = await crypto.subtle.encrypt(
  { name: "AES-GCM", iv: iv },
  key,
  plaintext
);
```

## Рекомендации

1. **Используйте AES-256-GCM** для новых проектов
2. **Не используйте ECB** — виден паттерн данных
3. **Уникальный IV/Nonce** для каждого сообщения
4. **Проверяйте тег** в аутентифицированных режимах
5. **Constant-time** реализации для защиты от timing-атак
