---
sidebar_position: 7
---

import SHA256Visualizer from '@site/src/components/ciphers/SHA256Visualizer';
import HMACDemo from '@site/src/components/ciphers/HMACDemo';

# Хеш-функции

Криптографические хеш-функции преобразуют данные произвольной длины в строку фиксированной длины.

## SHA-256 визуализация

<SHA256Visualizer />

## Свойства криптографических хешей

| Свойство | Описание |
|----------|----------|
| **Детерминированность** | Один вход → один выход |
| **Быстрота** | Эффективное вычисление |
| **Лавинный эффект** | Малое изменение → полностью другой хеш |
| **Односторонность** | Невозможно восстановить вход |
| **Устойчивость к коллизиям** | Сложно найти два входа с одинаковым хешем |

## Семейство SHA-2

### Характеристики

| Алгоритм | Выход | Блок | Слово | Раундов |
|----------|-------|------|-------|---------|
| SHA-224 | 224 | 512 | 32 | 64 |
| SHA-256 | 256 | 512 | 32 | 64 |
| SHA-384 | 384 | 1024 | 64 | 80 |
| SHA-512 | 512 | 1024 | 64 | 80 |
| SHA-512/256 | 256 | 1024 | 64 | 80 |

### Структура SHA-256

```
┌─────────────────────────────────────────┐
│              Сообщение                  │
└────────────────────┬────────────────────┘
                     │
              ┌──────▼──────┐
              │   Padding   │ + длина (64 бит)
              └──────┬──────┘
                     │
              ┌──────▼──────┐
              │   Блоки     │ по 512 бит
              │  M1, M2...  │
              └──────┬──────┘
                     │
         ┌───────────┼───────────┐
         │           │           │
    ┌────▼────┐ ┌────▼────┐     │
    │ Сжатие  │ │ Сжатие  │ ... │
    │   M1    │ │   M2    │     │
    └────┬────┘ └────┬────┘     │
         │           │           │
         H₁         H₂         H_n
                               │
              ┌────────────────▼───────────────┐
              │        Финальный хеш           │
              │          (256 бит)             │
              └────────────────────────────────┘
```

### Функция сжатия

64 раунда с 8 рабочими переменными (a, b, c, d, e, f, g, h):

```python
for i in range(64):
    S1 = ROTR(e, 6) ⊕ ROTR(e, 11) ⊕ ROTR(e, 25)
    ch = (e ∧ f) ⊕ (¬e ∧ g)
    T1 = h + S1 + ch + K[i] + W[i]
    
    S0 = ROTR(a, 2) ⊕ ROTR(a, 13) ⊕ ROTR(a, 22)
    maj = (a ∧ b) ⊕ (a ∧ c) ⊕ (b ∧ c)
    T2 = S0 + maj
    
    h, g, f, e, d, c, b, a = g, f, e, d+T1, c, b, a, T1+T2
```

### Расширение сообщения

16 слов → 64 слова:

```python
for i in range(16, 64):
    s0 = ROTR(W[i-15], 7) ⊕ ROTR(W[i-15], 18) ⊕ (W[i-15] >> 3)
    s1 = ROTR(W[i-2], 17) ⊕ ROTR(W[i-2], 19) ⊕ (W[i-2] >> 10)
    W[i] = W[i-16] + s0 + W[i-7] + s1
```

## HMAC

<HMACDemo />

### Формула HMAC

```
HMAC(K, m) = H((K' ⊕ opad) || H((K' ⊕ ipad) || m))
```

Где:
- **K'** — ключ, дополненный до размера блока
- **ipad** = 0x36, повторённый B раз
- **opad** = 0x5C, повторённый B раз
- **B** — размер блока хеш-функции (64 для SHA-256)

### Безопасность HMAC

- Устойчив к length extension attacks
- Безопасность зависит от хеш-функции
- HMAC-SHA256 считается безопасным

## Сравнение хеш-функций

| Алгоритм | Выход | Статус | Примечание |
|----------|-------|--------|------------|
| MD5 | 128 | ❌ | Коллизии за секунды |
| SHA-1 | 160 | ❌ | Коллизии найдены (2017) |
| SHA-256 | 256 | ✅ | Рекомендован |
| SHA-384 | 384 | ✅ | Для высокой безопасности |
| SHA-512 | 512 | ✅ | Быстрее SHA-256 на 64-бит |
| SHA-3 | 224-512 | ✅ | Другая конструкция (Keccak) |
| BLAKE2 | 256/512 | ✅ | Быстрее SHA-3 |
| BLAKE3 | 256 | ✅ | Очень быстрый |

## SHA-3 (Keccak)

### Отличия от SHA-2

| Параметр | SHA-2 | SHA-3 |
|----------|-------|-------|
| Конструкция | Меркла-Дамгора | Sponge |
| Операции | ADD, ROTR, AND, XOR | XOR, AND, NOT, ROT |
| Состояние | 256 бит | 1600 бит |
| Устойчивость к length extension | ❌ | ✅ |

### Sponge-конструкция

```
              Сообщение (блоки)
                   │ │ │
              ┌────▼─▼─▼────┐
              │   Absorb    │ ← XOR с состоянием + f
              └──────┬──────┘
                     │
              ┌──────▼──────┐
              │   Squeeze   │ → Выходные блоки
              └─────────────┘
```

## Атаки на хеш-функции

### Birthday Attack

Вероятность коллизии ≈ 50% после 2^(n/2) хешей.

| Алгоритм | Выход | Birthday bound |
|----------|-------|----------------|
| MD5 | 128 | 2⁶⁴ |
| SHA-1 | 160 | 2⁸⁰ |
| SHA-256 | 256 | 2¹²⁸ |

### Length Extension

Для SHA-256: зная H(m), можно вычислить H(m || padding || m') без знания m.

**Защита:** HMAC или SHA-3.

### Preimage Resistance

- **First preimage:** Дан h, найти m: H(m) = h
- **Second preimage:** Дан m₁, найти m₂: H(m₁) = H(m₂)

Для хорошей хеш-функции сложность ≈ 2ⁿ.

## Применение

### Хранение паролей

```
❌ Плохо: hash = SHA256(password)
✅ Хорошо: hash = bcrypt(password, salt, cost)
          hash = Argon2(password, salt, memory, time)
```

**Специализированные функции:**
- bcrypt
- scrypt
- Argon2 (победитель PHC)

### Цифровые подписи

```
message → SHA-256 → hash → RSA/ECDSA → signature
```

### Blockchain

```
block_hash = SHA256(SHA256(header))
```

### Целостность файлов

```bash
sha256sum file.iso > file.sha256
sha256sum -c file.sha256
```

## Утилиты

### Linux/macOS

```bash
# SHA-256
echo -n "hello" | sha256sum
sha256sum file.txt

# Все алгоритмы
openssl dgst -sha256 file.txt
openssl dgst -sha3-256 file.txt
```

### Python

```python
import hashlib

# SHA-256
h = hashlib.sha256(b"hello").hexdigest()

# HMAC
import hmac
mac = hmac.new(key, message, hashlib.sha256).hexdigest()
```

### JavaScript

```javascript
// Browser
const hash = await crypto.subtle.digest('SHA-256', data);

// Node.js
const crypto = require('crypto');
const hash = crypto.createHash('sha256').update('hello').digest('hex');
```

## Рекомендации

1. **Используйте SHA-256+** для общих целей
2. **bcrypt/Argon2** для паролей
3. **HMAC** для аутентификации сообщений
4. **Не используйте** MD5, SHA-1 в криптографии
5. **Соль** для защиты от rainbow tables
