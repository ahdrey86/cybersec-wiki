---
sidebar_position: 4
---

import MacAnalyzer from '@site/src/components/network/MacAnalyzer';

# MAC-адреса и Ethernet

MAC-адрес (Media Access Control) — уникальный идентификатор сетевого интерфейса на канальном уровне.

## Анализатор MAC-адресов

<MacAnalyzer />

## Структура MAC-адреса

48-битный (6 байт) адрес:

```
00:1A:2B:3C:4D:5E
├─────┤ ├─────┤
  OUI     NIC
  
OUI — Organizationally Unique Identifier (производитель)
NIC — Network Interface Controller (уникальный номер)
```

### Биты специального назначения

```
Первый октет: XX:XX:XX:XX:XX:XX
              │└─ Бит 1: 0 = Unicast, 1 = Multicast
              └── Бит 2: 0 = Глобальный (UAA), 1 = Локальный (LAA)
              
Примеры:
00:... — Unicast, глобальный (обычный)
01:... — Multicast
02:... — Unicast, локально администрируемый
03:... — Multicast, локальный
```

### Форматы записи

| Формат | Пример | Где используется |
|--------|--------|------------------|
| Colon | 00:1A:2B:3C:4D:5E | Linux, Unix |
| Dash | 00-1A-2B-3C-4D-5E | Windows |
| Dot | 001A.2B3C.4D5E | Cisco |
| Bare | 001A2B3C4D5E | Программирование |

## Ethernet

### Формат кадра Ethernet II

```
┌──────────┬──────────┬──────┬─────────────┬─────┐
│ Dst MAC  │ Src MAC  │ Type │   Payload   │ FCS │
│  6 байт  │  6 байт  │2 байт│ 46-1500 байт│4 бт │
└──────────┴──────────┴──────┴─────────────┴─────┘

Type (EtherType):
- 0x0800 — IPv4
- 0x0806 — ARP
- 0x86DD — IPv6
- 0x8100 — VLAN (802.1Q)
```

### Формат 802.3 с LLC

```
┌──────────┬──────────┬──────┬─────┬─────────────┬─────┐
│ Dst MAC  │ Src MAC  │Length│ LLC │   Payload   │ FCS │
│  6 байт  │  6 байт  │2 байт│3-5 б│  до 1500 б  │4 бт │
└──────────┴──────────┴──────┴─────┴─────────────┴─────┘
```

## Работа коммутатора

### Таблица MAC-адресов (CAM Table)

Коммутатор изучает MAC-адреса и строит таблицу:

| MAC-адрес | Порт | VLAN | Время |
|-----------|------|------|-------|
| 00:1A:2B:3C:4D:5E | Fa0/1 | 1 | 300с |
| 00:11:22:33:44:55 | Fa0/2 | 1 | 250с |
| AA:BB:CC:DD:EE:FF | Fa0/3 | 10 | 180с |

### Алгоритм работы

```
1. Получен кадр на порту X
2. Изучение: записать Source MAC → порт X
3. Поиск: найти Destination MAC в таблице
   - Найден → переслать на нужный порт
   - Не найден → flood на все порты (кроме X)
4. Broadcast (FF:FF:FF:FF:FF:FF) → flood всегда
```

## Специальные MAC-адреса

| Адрес | Назначение |
|-------|------------|
| FF:FF:FF:FF:FF:FF | Broadcast (широковещательный) |
| 01:00:5E:XX:XX:XX | IPv4 Multicast |
| 33:33:XX:XX:XX:XX | IPv6 Multicast |
| 01:80:C2:00:00:00 | STP (Spanning Tree) |
| 01:00:0C:CC:CC:CC | Cisco CDP/VTP |

## ARP (Address Resolution Protocol)

Связывает IP-адреса с MAC-адресами.

### Процесс

```
1. Хост A хочет отправить пакет на IP 192.168.1.20
2. A не знает MAC для этого IP
3. A отправляет ARP Request (broadcast):
   "Кто имеет 192.168.1.20? Ответьте на 00:AA:BB:CC:DD:EE"
4. Хост с IP 192.168.1.20 отвечает (unicast):
   "192.168.1.20 — это 00:11:22:33:44:55"
5. A записывает в ARP-кэш: 192.168.1.20 → 00:11:22:33:44:55
```

### ARP-таблица

```bash
# Linux
arp -a
ip neigh show

# Windows
arp -a
```

### Атаки на ARP

| Атака | Описание | Защита |
|-------|----------|--------|
| ARP Spoofing | Подмена MAC в ответах | Static ARP, DAI |
| ARP Cache Poisoning | Отравление кэша | 802.1X, Port Security |
| Gratuitous ARP | Неожиданные объявления | DAI (Dynamic ARP Inspection) |

## VLAN (Virtual LAN)

Логическое разделение сети на канальном уровне.

### Тег 802.1Q

```
┌──────────┬──────────┬──────────┬──────┬─────────────┬─────┐
│ Dst MAC  │ Src MAC  │ 802.1Q   │ Type │   Payload   │ FCS │
│  6 байт  │  6 байт  │  4 байта │2 байт│  до 1500 б  │4 бт │
└──────────┴──────────┴──────────┴──────┴─────────────┴─────┘

802.1Q Tag (4 байта):
┌────────────┬─────┬─────┬──────────────┐
│    TPID    │ PCP │ DEI │   VLAN ID    │
│  0x8100    │ 3бит│ 1бит│    12 бит    │
└────────────┴─────┴─────┴──────────────┘

VLAN ID: 0-4095 (0 и 4095 зарезервированы)
```

### Типы портов

| Тип | Описание | Тегирование |
|-----|----------|-------------|
| Access | Подключение конечных устройств | Без тега |
| Trunk | Между коммутаторами | С тегом 802.1Q |
| Native VLAN | VLAN без тега на trunk | Без тега |

:::warning Безопасность
Не использовать VLAN 1 как рабочий — это Native VLAN по умолчанию и цель атак (VLAN Hopping).
:::
