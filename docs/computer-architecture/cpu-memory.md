---
sidebar_position: 1
---

import MemoryHierarchy from '@site/src/components/architecture/MemoryHierarchy';
import NumberConverter from '@site/src/components/architecture/NumberConverter';
import DataSizeCalculator from '@site/src/components/architecture/DataSizeCalculator';
import ProcessMemoryVisualizer from '@site/src/components/architecture/ProcessMemoryVisualizer';

# Процессоры и память

Основные компоненты вычислительной системы.

## Центральный процессор (CPU)

### Архитектуры

| Архитектура | Тип | Характеристики | Примеры |
|-------------|-----|----------------|---------|
| **x86-64** | CISC | Настольные/серверные, обратная совместимость | Intel Core, AMD Ryzen |
| **ARM** | RISC | Энергоэффективность, мобильные/встраиваемые | Apple M-series, Qualcomm, AWS Graviton |
| **RISC-V** | RISC | Открытая ISA, расширяемость | SiFive, Alibaba T-Head |

### CISC vs RISC

| Параметр | CISC | RISC |
|----------|------|------|
| Инструкции | Сложные, переменной длины | Простые, фиксированной длины |
| Количество | Много (сотни) | Мало (десятки) |
| Регистры | Меньше | Больше |
| Циклов на инструкцию | Больше | Меньше (часто 1) |
| Энергопотребление | Выше | Ниже |
| Пример | x86, x86-64 | ARM, RISC-V, MIPS |

### Компоненты процессора

```
┌─────────────────────────────────────────────────────────┐
│                      Процессор                          │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │   Ядро 0    │  │   Ядро 1    │  │   Ядро N    │     │
│  │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │     │
│  │ │   ALU   │ │  │ │   ALU   │ │  │ │   ALU   │ │     │
│  │ │   FPU   │ │  │ │   FPU   │ │  │ │   FPU   │ │     │
│  │ │  SIMD   │ │  │ │  SIMD   │ │  │ │  SIMD   │ │     │
│  │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │     │
│  │  L1i  L1d   │  │  L1i  L1d   │  │  L1i  L1d   │     │
│  │    L2       │  │    L2       │  │    L2       │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
├─────────────────────────────────────────────────────────┤
│                  L3 Cache (shared)                      │
├─────────────────────────────────────────────────────────┤
│    Memory Controller    │    PCIe Controller    │ ...  │
└─────────────────────────────────────────────────────────┘
```

### Конвейер (Pipeline)

Современные процессоры используют конвейер для параллельного выполнения инструкций:

| Стадия | Название | Описание |
|--------|----------|----------|
| 1 | **Fetch** | Выборка инструкции из памяти/кэша |
| 2 | **Decode** | Декодирование инструкции |
| 3 | **Execute** | Выполнение операции в ALU/FPU |
| 4 | **Memory** | Доступ к памяти (load/store) |
| 5 | **Writeback** | Запись результата в регистр |

**Оптимизации:**
- **Суперскалярность** — несколько инструкций за такт
- **Out-of-Order** — выполнение не по порядку
- **Предсказание переходов** — угадывание if/else
- **Спекулятивное исполнение** — выполнение до проверки

### Регистры x86-64

| Регистр | 64-bit | 32-bit | 16-bit | 8-bit | Назначение |
|---------|--------|--------|--------|-------|------------|
| RAX | RAX | EAX | AX | AL/AH | Аккумулятор, возврат функций |
| RBX | RBX | EBX | BX | BL/BH | База |
| RCX | RCX | ECX | CX | CL/CH | Счётчик циклов |
| RDX | RDX | EDX | DX | DL/DH | Данные, I/O |
| RSI | RSI | ESI | SI | SIL | Source index |
| RDI | RDI | EDI | DI | DIL | Destination index |
| RSP | RSP | ESP | SP | SPL | Stack pointer |
| RBP | RBP | EBP | BP | BPL | Base pointer |
| R8-R15 | R8-R15 | R8D-R15D | R8W-R15W | R8B-R15B | Общего назначения |
| RIP | RIP | EIP | IP | — | Instruction pointer |
| RFLAGS | RFLAGS | EFLAGS | FLAGS | — | Флаги состояния |

## Иерархия памяти

<MemoryHierarchy />

### Принцип локальности

- **Временна́я локальность** — если данные использованы, скоро понадобятся снова
- **Пространственная локальность** — если данные использованы, соседние тоже понадобятся

Кэш использует эти принципы для ускорения доступа.

### Кэш-память

| Параметр | L1d | L1i | L2 | L3 |
|----------|-----|-----|----|----|
| Размер | 32-48 КБ | 32 КБ | 256-512 КБ | 8-64 МБ |
| Задержка | 3-4 такта | 3-4 такта | 10-12 тактов | 30-40 тактов |
| Ассоциативность | 8-12 way | 8 way | 8 way | 12-16 way |
| Общий | Нет (per core) | Нет | Нет | Да |

**Политики замещения:**
- **LRU** — Least Recently Used
- **PLRU** — Pseudo-LRU
- **Random** — случайный выбор

## Конвертер систем счисления

<NumberConverter />

## Калькулятор размеров данных

<DataSizeCalculator />

## Оперативная память (RAM)

### Типы DDR

| Стандарт | Частота | Напряжение | Пропускная способность |
|----------|---------|------------|------------------------|
| DDR3 | 800-2133 МГц | 1.5V | 6.4-17 ГБ/с |
| DDR4 | 2133-3200 МГц | 1.2V | 17-25.6 ГБ/с |
| DDR5 | 4800-8400 МГц | 1.1V | 38.4-67.2 ГБ/с |

### Тайминги

Формат: **CL-tRCD-tRP-tRAS** (например, 16-18-18-36)

| Тайминг | Название | Описание |
|---------|----------|----------|
| CL | CAS Latency | Задержка доступа к столбцу |
| tRCD | RAS to CAS Delay | Задержка активации строки |
| tRP | Row Precharge | Время закрытия строки |
| tRAS | Row Active Time | Минимальное время активности |

### Режимы работы

- **Single Channel** — один канал памяти
- **Dual Channel** — два канала, удвоение пропускной способности
- **Quad Channel** — четыре канала (серверы, HEDT)

### ECC память

Error Correction Code — исправление одиночных ошибок, обнаружение двойных.

- Добавляет 1 бит на 8 бит данных (9 вместо 8 чипов)
- Используется в серверах, рабочих станциях
- Защищает от bit flip (космические лучи, радиация)

## Адресация памяти

### Виртуальная память

```
Виртуальный адрес → MMU/TLB → Физический адрес
         │              │
         │       ┌──────┴──────┐
         │       │ Page Table  │
         │       └─────────────┘
         │
    ┌────┴────┬─────────┐
    │ PML4    │ Offset  │  48-bit virtual address
    │ (9 bit) │ (12 bit)│
    └─────────┴─────────┘
```

**Размеры страниц:**
| Размер | Название | Использование |
|--------|----------|---------------|
| 4 КБ | Standard | По умолчанию |
| 2 МБ | Huge Pages | БД, виртуализация |
| 1 ГБ | Gigantic Pages | Большие серверы |

### TLB (Translation Lookaside Buffer)

Кэш для ускорения трансляции виртуальных адресов:
- L1 TLB: ~64 записей, 1 такт
- L2 TLB: ~1024 записей, ~10 тактов

## Память процесса

<ProcessMemoryVisualizer />

### Сегменты памяти

| Сегмент | Содержимое | Права | Направление |
|---------|------------|-------|-------------|
| **Text** | Код программы | r-x | — |
| **Data** | Инициализированные глобальные | rw- | — |
| **BSS** | Неинициализированные глобальные | rw- | — |
| **Heap** | Динамическая память (malloc) | rw- | ↑ вверх |
| **Stack** | Локальные, адреса возврата | rw- | ↓ вниз |

### Защита памяти

| Механизм | Описание |
|----------|----------|
| **ASLR** | Рандомизация адресов (стек, heap, библиотеки) |
| **DEP/NX** | Запрет исполнения в сегментах данных |
| **Stack Canary** | Защита от переполнения буфера |
| **PIE** | Позиционно-независимый код |
| **SMEP/SMAP** | Защита ядра от user-space |

## Прерывания

### Типы прерываний

| Тип | Источник | Примеры |
|-----|----------|---------|
| **Hardware (IRQ)** | Устройства | Клавиатура, таймер, сеть |
| **Software (INT)** | Программа | Системные вызовы |
| **Exception** | CPU | Деление на 0, page fault |

### Таблица векторов (x86-64)

| Вектор | Название | Тип |
|--------|----------|-----|
| 0 | #DE | Division Error |
| 6 | #UD | Invalid Opcode |
| 13 | #GP | General Protection |
| 14 | #PF | Page Fault |
| 32-255 | — | IRQ, syscalls |

## Системные вызовы

### Linux x86-64

```nasm
; Пример: write(1, "Hello", 5)
mov rax, 1      ; syscall number (write)
mov rdi, 1      ; fd (stdout)
mov rsi, msg    ; buffer
mov rdx, 5      ; length
syscall         ; invoke kernel
```

### Популярные syscalls

| Номер | Название | Описание |
|-------|----------|----------|
| 0 | read | Чтение из файла |
| 1 | write | Запись в файл |
| 2 | open | Открыть файл |
| 3 | close | Закрыть файл |
| 9 | mmap | Отобразить память |
| 60 | exit | Завершить процесс |
| 231 | exit_group | Завершить все потоки |
